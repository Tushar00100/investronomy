language: node_js
# if using Ubuntu 16 need this library
# https://github.com/cypress-io/cypress-documentation/pull/1647
addons:
  apt:
    packages:
      - libgconf-2-4
install:
  - npm ci
script:
  - npm test && npm run build
  # serve built files in /dist for cypress
  - npm run start:dist &
  # run cypress tests
  - npm run cy:run
  # after all tests finish running we need
  # to kill all background jobs (like "npm start &")
  - kill $(jobs -p) || true
deploy:
  provider: pages
  skip-cleanup: true
  local-dir: dist
  target-branch: gh-pages
  github-token: "$GITHUB_TOKEN"
  keep-history: true
  verbose: true
  on:
    branch: master
env:
  global:
    - CYPRESS_CRASH_REPORTS=0
